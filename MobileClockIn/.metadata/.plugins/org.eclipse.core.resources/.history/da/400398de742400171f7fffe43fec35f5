package com.gess.base;

import java.util.Locale;
import java.util.Properties;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.context.SecurityContextHolder;

import com.gess.base.model.IUser;

//ssssssssssss
public class BaseSystem {
	
	@Autowired
	protected Properties appProperties;

	public static String locale="ka";
	
	protected static BaseSystem instance=null;
	
	protected static Locale userLocale;
	
	protected static IUser  user;
	
	protected BaseSystem(){
		
	}
	

	public static void setUser(IUser  user) {
		BaseSystem.user=user;
	}
	public static IUser getUser() {
//		return BaseSystem.user;
		if(SecurityContextHolder.getContext()==null
			|| SecurityContextHolder.getContext().getAuthentication()==null
			|| SecurityContextHolder.getContext().getAuthentication().getPrincipal()==null
		)
			return null;
		
		if(SecurityContextHolder.getContext().getAuthentication().getPrincipal() instanceof String)
			return null;
		
		return (IUser) SecurityContextHolder.getContext().getAuthentication().getPrincipal();
	}
	
	public static IUser getSpringSecurityUser() {
		if(SecurityContextHolder.getContext()==null
			|| SecurityContextHolder.getContext().getAuthentication()==null
			|| SecurityContextHolder.getContext().getAuthentication().getPrincipal()==null
		)
			return null;
		if(SecurityContextHolder.getContext().getAuthentication().getPrincipal() instanceof String)
			return null;
		return (IUser) SecurityContextHolder.getContext().getAuthentication().getPrincipal();
	}
	
	public static BaseSystem getInstance(){
		if(instance==null)
			instance=new BaseSystem();
		return instance;
	}
	
	public Properties getProperties(){
		return appProperties;
	}
	
	public String getProperty(String key, String defaultValue){
		return appProperties.getProperty(key, defaultValue);
	}

	public String getProperty(String key){
		return appProperties.getProperty(key);
	}

	public static Locale getUserLocale() {
		if(userLocale==null)
			return Locale.ENGLISH;
		return userLocale;
	}

	public static void setUserLocale(Locale userLocale) {
		BaseSystem.userLocale = userLocale;
	}

	public static String getUserLocaleCode() {
		return getUserLocale().getLanguage();
	}
}
